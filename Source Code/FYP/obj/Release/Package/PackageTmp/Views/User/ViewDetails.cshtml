@model FYP.Models.AddPackageModel
@{
    ViewBag.Title = "View Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>

    .modal-body {
        padding: 0 !important;
    }

    .container {
        position: relative;
        text-align: center;
        color: white;
        height: 500px !important;
        margin: 0 !important;
        padding: 0 !important;
        max-width: inherit !important;
    }

    .centered {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        /*background-color: #00000057;
        padding: 50px;
        border-radius: 10px;*/
    }

        .centered h2 {
            color: #FFFAB0;
            font-size: 66px;
            line-height: 1.05;
            letter-spacing: .1px;
            font-weight: 700;
            margin: 0 auto 13px;
            overflow: visible;
            max-height: 207px;
            display: block;
            border-bottom: 1px dashed transparent;
            -webkit-font-smoothing: antialiased;
            text-shadow: 0 15px 40px rgb(0 0 0 / 20%);
        }

        .centered span {
            background-color: #00000075;
            border-radius:10px;
            padding:5px 25px;
            font-family: 'Klarna Text';
            line-height: 1.3;
            font-weight: 400;
            font-size: 20px;
            letter-spacing: .4px;
            display: inline-block;
            text-align: center;
            color: #FFFAB0;
        }

    .header {
        overflow: hidden;
        box-shadow: 0 1px 15px 0 rgb(0 0 0 / 20%);
        height: 48px;
    }

        .header a {
            float: left;
            color: black;
            text-align: center;
            padding: 12px;
            text-decoration: none;
            font-size: 18px;
            line-height: 25px;
            border-radius: 4px;
        }

            .header a:hover {
                background-color: #ddd;
                color: black;
            }

            .header a.active {
                height: calc(100%);
                border-bottom: 3px solid #0E0E0F;
                color: #0E0E0F;
            }

    .header-right {
        margin: 0 558px;
        float: left;
        height: 48px;
    }

    #map-canvas {
        height: 400px;
        width: 100%;
    }

    /*.column {
        float: left;
        width: 25%;
        padding: 0 10px;
    }

    .row {
        margin: 0 -5px;
    }

        .row:after {
            content: "";
            display: table;
            clear: both;
        }*/

    .card {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        padding: 16px;
        /*text-align: center;*/
        background-color: #f1f1f1;
        margin: 15px auto;
        background-color: white;
        border-radius: 5px;
    }

    .card-header {
        font-size: 25px;
        font-weight: bold;
        background-color: white !important;
    }

    .card-title {
        font-size: 20px;
        font-weight: bold;
    }

    .card-text {
        font-size: 15px;
    }

    a {
        text-decoration: none !important;
    }

    #weatherBtn {
        margin: 0 !important;
        padding: 6px 40px;
        font-size: 15px;
        font-weight: 900;
        border-radius: 20px;
        float: right;
        background-color: black;
        border: none;
        color: white;
    }

        #weatherBtn:hover {
            background-color: #333333;
        }

    .btn {
        display: inline-block !important;
        margin-top: 1rem;
        background: var(--orange) !important;
        color: #fff !important;
        padding: 0.8rem 3rem !important;
        border: 0.2rem solid var(--orange) !important;
        cursor: pointer !important;
        font-size: 1.7rem !important;
    }

    /*.bookingdiv {
        display: grid;
        margin-left: auto;
        margin-right: auto;
    }*/

    .bookingbtn {
        /*border: none !important;*/
        /*opacity: 0.7;*/
        color: white !important;
        font-weight: bold !important;
        text-transform: uppercase;
        border-radius: 50px !important;
        width: 250px;
        background-color: transparent !important;
        /*padding: 40px !important;*/
        /*border: 2px solid black !important;*/
        /*position: relative;
        border: 5px solid #ffbf49 !important;
        text-align: center !important;
        font-size: 25px !important;
        color: #FFFAB0 !important;
        font-weight: 900 !important;
        text-transform: uppercase;
        letter-spacing: 15px;
        cursor: pointer !important;
        border-radius: 100px !important;
        transition: 1.5s !important;*/
    }

        .bookingbtn:hover {
            /*background-color: #333333 !important;*/
            /*box-shadow: 0 5px 50px 0 #FFFAB0 inset, 0 5px 50px 0 #ffbf49,
                        0 5px 50px 0 #FFFAB0 inset, 0 5px 50px 0 #ffbf49;
            text-shadow: 0 0 5px #FFFAB0,0 0 5px #FFFAB0;*/
            background-color: transparent !important;
            color:orange !important;
        }

    .navbar {
        margin-left: auto;
        margin-right: auto;
    }

    .navbar-nav {
        margin-right: 0 !important;
    }

    .card-deck {
        width: 1030px;
        margin-right: auto;
        margin-left: auto;
        font-size: initial;
    }

    .scrollDiv {
        width: 100%;
        height: auto;
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        overflow-y: hidden;
        scroll-behavior: smooth;
        /*-webkit-overflow-scrolling: touch;*/
    }

        .scrollDiv::-webkit-scrollbar {
            width: 5px;
            height: 8px;
            background-color: #aaa;
            /*-webkit-appearance: none;*/
        }

        .scrollDiv::-webkit-scrollbar-thumb {
            background-color: black;
        }

    .child {
        width: 200px;
        height: auto;
        margin: 1px 10px;
        overflow: hidden;
    }
        .child img {
            width: 100%;
            height: 100px;
            /*object-fit: cover;*/
            object-position: center;
        }

    .cover {
        padding: 0px 30px;
        position: relative;
    }

    .left {
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
    }

    .right {
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
    }
</style>

<link href="~/Content/userassests/css/viewDetailsStyle.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
@*<div class="bg-image" style="background-image: @Url.Content(Model.Picture); height: 100vh">*@
@*</div>*@

<div class="container">
    @*<img src="@Url.Content(Model.Picture)" alt="@Url.Content(Model.Name)" style="width:100%;">*@
    @{
        var url = @Model.Picture.Replace("~", "");
        url = "http://localhost:53010" + url;
        <img src="@url" style="width:100%; height:500px;" />

    }
    <div class="centered">
        <h2>@Model.Name</h2>
        @{
            var date = @Model.No_of_Days.Split(',');
            var sum = 0;
            foreach (var d in date) sum += Convert.ToInt32(d);
            var dateTo = Model.Date.AddDays(sum).ToString("dd-MMMM-yyyy");
            <span>@Model.Date.ToString("dd-MMMM-yyyy") - @dateTo</span>

        }
        <div class="bookingdiv">
            @Html.ActionLink("BOOK NOW", "Booking", "User", new { userID = Session["U_Id"], packID = Model.Package_ID }, new { @id = "bookbtnid", @class = "btn bookingbtn" })
            @*<a href="/User/Booking" class="btn bookingbtn">Book Now</a>*@
        </div>
    </div>
</div>

<div>
    <div class="header">
        <div class="header-right">
            <a class="active" href="#home">Route</a>
            <a href="#contact">@*Day by Day*@</a>
            @*<a href="#about">About</a>*@
        </div>
    </div>
</div>

<div class="timeline-container">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic' rel='stylesheet' type='text/css'>
    <ul class="timeline my-3" id="routeId"></ul>
    <div id="map-canvas"></div>
</div>

<div id="citiesCards"></div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="width:450px;">
            @*<div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>*@
            <div class="modal-body">
                <div class="row" style="margin-right:0;">
                    <div class="col" style="background-color:black;">
                        <div style="padding:25px;">
                            <span id="temperature" style="font-size: 48px; color: #ffffffc7;"></span><hr />
                            <span id="cityName" style="font-size: 20px; color: #ffffffc7; font-weight:bold;"></span>
                        </div>
                    </div>
                    <div class="col" style="padding:0;">
                        <div class="row">
                            <img id="weatherImage" style="width:100%; height:150px;" onclick="openImageInTab(this)" />
                        </div>
                        <div class="row" style="margin: 0; background-color: lightblue;">
                            <span id="details" style="font-size: 20px; font-weight: bold; text-align: center; color: #ffffff; padding:12px;"></span>
                        </div>
                    </div>
                </div>
            </div>
            @*<div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>*@
        </div>
    </div>
</div>

<div class="card-deck">

    <div class="card" style="width: 18rem;">
        <div class="card-header">
            Tour Info
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <i class="fas fa-shield-alt"></i>
                Lowest Price Guarantee
            </li>
            <li class="list-group-item">
                <i class="fas fa-mobile"></i>
                Ticket type: Mobile
            </li>
            <li class="list-group-item">
                <i class="fas fa-users"></i>
                Available Seats: @Model.Total_Seats
            </li>
            <li class="list-group-item">
                <i class="fas fa-clock"></i>
                Duration: @Model.No_of_Days Days
            </li>
            <li class="list-group-item">
                <i class="fas fa-luggage-cart"></i>
                Departure From: @Model.Pick_Up_Location
            </li>
        </ul>
    </div>
    <div class="card" style="width: 18rem;">
        <div class="card-header">
            Inclusions
        </div>
        <ul class="list-group list-group-flush">
            @{
                string inclusion = Model.Inclusions;
                string[] inclusionArray = inclusion.Split(',');

                foreach (string incln in inclusionArray)
                {
                    <li class="list-group-item">@incln</li>
                }
            }
        </ul>
    </div>
    <div class="card" style="width: 18rem;">
        <div class="card-header">
            Exclusions
        </div>
        <ul class="list-group list-group-flush">
            @{
                string exclusion = Model.Exclusions;
                string[] exclusionArray = exclusion.Split(',');

                foreach (string excln in exclusionArray)
                {
                    <li class="list-group-item">@excln</li>
                }
            }
        </ul>
    </div>
</div>

<section style="background-color: #e7effd; margin-top:20px; margin-bottom:0 !important;">
    <div class="container my-5 py-5 text-dark">
        <div class="row d-flex justify-content-center">
            <div class="col-md-11 col-lg-9 col-xl-7" style="width:1000px; text-align:left;">
               
                <div class="d-flex flex-start mb-4">
                    <img class="rounded-circle shadow-1-strong me-3"
                         src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(32).webp" alt="avatar" width="65"
                         height="65" />
                    <div class="card w-100">
                        <div class="card-body p-4">
                            <div class="">
                                <h5>Johny Cash</h5>
                                <p class="small">3 hours ago</p>
                                <p>
                                    Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque
                                    ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus
                                    viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla.
                                    Donec lacinia congue felis in faucibus ras purus odio, vestibulum in
                                    vulputate at, tempus viverra turpis.
                                </p>

                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center">
                                        <a href="#!" class="link-muted me-2"><i class="fas fa-thumbs-up me-1"></i>132</a>
                                        <a href="#!" class="link-muted"><i class="fas fa-thumbs-down me-1"></i>15</a>
                                    </div>
                                    @*<a href="#!" class="link-muted"><i class="fas fa-reply me-1"></i> Reply</a>*@
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex flex-start">
                    <img class="rounded-circle shadow-1-strong me-3"
                         src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img%20(31).webp" alt="avatar" width="65"
                         height="65" />
                    <div class="card w-100">
                        <div class="card-body p-4">
                            <div class="">
                                <h5>Mindy Campbell</h5>
                                <p class="small">5 hours ago</p>
                                <p>
                                    Lorem ipsum dolor sit, amet consectetur adipisicing elit. Delectus
                                    cumque doloribus dolorum dolor repellat nemo animi at iure autem fuga
                                    cupiditate architecto ut quam provident neque, inventore nisi eos quas?
                                </p>

                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center">
                                        <a href="#!" class="link-muted me-2"><i class="fas fa-thumbs-up me-1"></i>158</a>
                                        <a href="#!" class="link-muted"><i class="fas fa-thumbs-down me-1"></i>13</a>
                                    </div>
                                    <a href="#!" class="link-muted"><i class="fas fa-reply me-1"></i> Reply</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
@*<script src="~/Scripts/bootstrap.min.js"></script>*@
<script src="~/Content/assetstable/vendor/jquery/jquery.min.js"></script>
<script src="~/Scripts/jquery-3.6.0.js"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script src="https://unpkg.com/location-picker/dist/location-picker.min.js"></script>

<script>

    const labels = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    let labelIndex = 0;

    $.get("/User/PakageCityDetails/@Model.Package_ID", function (data) {
        console.log(data);
        var routeDetails = document.getElementById("routeId")
        var cityCards = document.getElementById("citiesCards")

        var rhtml = ""
        var cardhtml = ""
        

        for (let route = 0; route < data.Cities.length; route++) {
            if (route % 2 == 0) {
                rhtml += `<li><div class="direction-r">
                <div class="flag-wrapper">
                    <span class="flag">${data.Cities[route].City_Name}</span>
                    <span class="time-wrapper"><span class="time">Stay ${data.Cities[route].StayDays} Days</span></span>
                </div>
                <div class="desc">${data.Cities[route].City_Details}</div>
            </div>
        </li>`
            }
            else {
                rhtml += `<li><div class="direction-l">
                <div class="flag-wrapper">
                    <span class="flag">${data.Cities[route].City_Name}</span>
                    <span class="time-wrapper"><span class="time">Stay ${data.Cities[route].StayDays} Days</span></span>
                </div>
                <div class="desc">${data.Cities[route].City_Details}</div>
            </div>
        </li>`
            }
        }
        for (let card = 0; card < data.Cities.length; card++) {
            let img3 = data.Cities[card].City_Picture1;
            
            let result = img3.replace("~/", "");
            result = "http://localhost:53010/" + result
            cardhtml += `<div>
                <div class="card" style="width: 100rem;">
                    <div class="card-header">
                        ${data.Cities[card].City_Name}
                        <a id="weatherBtn" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="weatherInfo('${data.Cities[card].City_Name}')">See Weather</a>
                      </div>
                        <br/>
                    <div class="card-body">
                        <div class="row" style="display:flex;">
                            <div class="col" style="margin-right:15px;">
                                <img class="card-img-top" style="width:100%;" src="${result}" alt="">
                            </div>
                            <div class="col">
                                <h5 class="card-title">Description</h5>
                                <p class="card-text">
                                    ${data.Cities[card].City_Details}
                                </p>
                            </div>
                        </div>
                        <hr style="margin-top:20px;"/>
                        <div class="row">
                            <h5 class="card-title">Highlights from your trip</h5>
                            <div class="row">
                             <div class="cover">
                              <button class="left" onclick="leftScroll()">
                                <i class="fas fa-angle-double-left"></i>
                              </button>
                              <div class="scrollDiv">
                            `
                                var placehtml = ""
                            for (var place = 0; place < data.Places.length; place++) {
                                if (data.Places[place].city == data.Cities[card].City_Name) {
                                    let placeimg = data.Places[place].pic;
                                    let imgresult = placeimg.replace("~/", "");
                                    imgresult = "http://localhost:53010/" + imgresult
                                    placehtml += `
                                        <div class="child">
                                            <div>
                                                <img class="child-img" src="${imgresult}" alt=""><br/>
                                            </div>
                                            <div>
                                                <h5>${data.Places[place].place}</h5>
                                            </div>
                                        </div>
                                    `
                                }
                            }
            placehtml += `</div>
                         <button class="right" onclick="rightScroll()">
                            <i class="fas fa-angle-double-right"></i>
                         </button>
                        </div>
                       </div>
                      </div>
                    </div>
                </div>
            </div>`
            cardhtml += placehtml;
        }
                        //<a href="#" class="btn btn-outline-primary btn-sm">
                        //    See Places
                        //</a>
                        //<a href="#" class="btn btn-outline-secondary btn-sm">
                        //    <i class="far fa-heart"></i></a>

        routeDetails.innerHTML = rhtml
        cityCards.innerHTML = cardhtml

        myOptions = {
            zoom: 6,
            center: new google.maps.LatLng(30.3753, 69.3451)
        },
            map = new google.maps.Map(document.getElementById('map-canvas'), myOptions),

            directionsService = new google.maps.DirectionsService,
            directionsDisplay = new google.maps.DirectionsRenderer({
                map: map
            }),
            setMarkers(map);

        function setMarkers(map) {
            for (let i = 0; i < data.Cities.length; i++) {
                var lat = parseFloat(data.Cities[i].Latitude);
                var long = parseFloat(data.Cities[i].Longitude);
                markerA = new google.maps.Marker({
                    position: { lat: parseFloat(data.Cities[i].Latitude), lng: long },
                    title: data.Cities[i].City_Name,
                    label: data.Cities[i].City_Name,
                    map: map
                });
                //console.log(markerA)
                //console.log(parseFloat(data.Cities[i].Latitude));
                //new google.maps.Marker({
                //    position: { lat: parseFloat(data.Cities[i].Latitude), lng: parseFloat(data.Cities[i].Longitutde) },
                //    map,
                //    title: labels[labelIndex++ % labels.length],
                //});
            }
        }
    });

    function leftScroll() {
        const left = document.querySelector(".scrollDiv");
        left.scrollBy(200, 0);
    }

    function rightScroll() {
        const right = document.querySelector(".scrollDiv");
        right.scrollBy(-200, 0);
    }

    function weatherInfo(cityName) {
        fetch(`http://api.weatherstack.com/current?access_key=075d846d602d0a343dcfa1cb604a72ee&query=` + cityName)
            .then((response) => response.json())
            .then((jsonData) => {
                console.log(jsonData)
                let img = jsonData.current.weather_icons[0];
                let weatherdetail = jsonData.current.weather_descriptions[0];
                const first = weatherdetail.split(',')[0]
                $("#weatherImage").attr("src", img);
                $("#cityName").text(jsonData.request.query);
                $("#temperature").text(jsonData.current.temperature + "°");
                $("#details").text(first);
            });
    }

    //function initMap() {
    //    myOptions = {
    //        zoom: 6,
    //        center: new google.maps.LatLng(30.3753, 69.3451)
    //    },
    //        map = new google.maps.Map(document.getElementById('map-canvas'), myOptions),

    //        directionsService = new google.maps.DirectionsService,
    //        directionsDisplay = new google.maps.DirectionsRenderer({
    //            map: map
    //        }),
    //        markerA = new google.maps.Marker({
    //            position: new google.maps.LatLng(33.6844, 73.0479),
    //            title: "point A",
    //            label: "A",
    //            map: map
    //        }),
    //        markerA = new google.maps.Marker({
    //            position: new google.maps.LatLng(36.3167, 74.6500),
    //            title: "point B",
    //            label: "B",
    //            map: map
    //        });
    //}

    //initMap();

</script>
